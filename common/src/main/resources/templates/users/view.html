<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(${pageTitle}, ~{::section})}">
<body>
<section>
    <!-- User Profile Header -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <i class="fas fa-user-circle fa-2x me-3"></i>
                <h3 class="mb-0" th:text="${user.profile.name}">User Profile</h3>
                <span class="badge bg-light text-dark ms-2" th:if="${user.access.role != null}"
                      th:text="${user.access.role}">ROLE</span>
                <span class="badge bg-success ms-2"
                      th:if="${user.profile.isVisibleToRecruiters}">Visible to Recruiters</span>
            </div>
            <div>
                <a th:href="@{/users/{id}/edit(id=${user.id})}" class="btn btn-sm btn-light me-1">
                    <i class="fas fa-edit me-1"></i>Edit
                </a>
                <form th:action="@{/users/{id}/delete(id=${user.id})}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-outline-light"
                            onclick="return confirm('Are you sure you want to delete this user?')">
                        <i class="fas fa-trash-alt me-1"></i>Delete
                    </button>
                </form>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="card border-0 bg-light h-100">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-id-card me-2"></i>Profile Info</h5>
                            <hr>
                            <p><strong>Name:</strong> <span th:text="${user.profile.name}">User Name</span></p>
                            <p><strong>Created:</strong> <span
                                    th:text="${#temporals.format(user.createdAt, 'dd MMM yyyy')}">01 Jan 2023</span></p>

                            <!-- CV Information -->
                            <div class="mt-4" th:if="${user.profile.cvFileName != null}">
                                <h6><i class="fas fa-file-alt me-2"></i>CV Information</h6>
                                <hr>
                                <p>
                                    <strong>File:</strong>
                                    <a th:href="${user.profile.cvFileHref}" th:text="${user.profile.cvFileName}"
                                       target="_blank">resume.pdf</a>
                                    <span class="text-muted ms-2"
                                          th:text="'(' + ${#numbers.formatDecimal(user.profile.cvFileSize / 1024, 0, 1)} + ' KB)'"></span>
                                </p>
                                <p><strong>Uploaded:</strong> <span
                                        th:text="${#temporals.format(user.profile.cvUploadedAt, 'dd MMM yyyy')}">01 Jan 2023</span>
                                </p>
                                <p th:if="${user.profile.aiCvScore != null}">
                                    <strong>CV Score:</strong>
                                    <span class="badge"
                                          th:classappend="${user.profile.aiCvScore >= 80 ? 'bg-success' : (user.profile.aiCvScore >= 50 ? 'bg-warning' : 'bg-danger')}"
                                          th:text="${user.profile.aiCvScore} + '/100'">80/100</span>
                                </p>
                            </div>

                            <!-- AI Settings -->
                            <div class="mt-4">
                                <h6><i class="fas fa-robot me-2"></i>AI Settings</h6>
                                <hr>
                                <p>
                                    <strong>AI Usage:</strong>
                                    <span class="badge"
                                          th:classappend="${user.access.aiUsageAllowed ? 'bg-success' : 'bg-secondary'}"
                                          th:text="${user.access.aiUsageAllowed ? 'Allowed' : 'Not Allowed'}">Allowed</span>
                                </p>
                                <p>
                                    <strong>AI Features:</strong>
                                    <span class="badge"
                                          th:classappend="${user.profile.aiUsageEnabled ? 'bg-success' : 'bg-secondary'}"
                                          th:text="${user.profile.aiUsageEnabled ? 'Enabled' : 'Disabled'}">Enabled</span>
                                </p>
                                <p th:if="${user.profile.aiPreferredLanguage != null}">
                                    <strong>Language:</strong>
                                    <span th:text="${user.profile.aiPreferredLanguage == 'en' ? 'English' : (user.aiPreferredLanguage == 'ru' ? 'Russian' : (user.aiPreferredLanguage == 'de' ? 'German' : (user.aiPreferredLanguage == 'fr' ? 'French' : user.aiPreferredLanguage)))}">English</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card border-0 bg-light h-100">
                        <div class="card-body">
                            <h5 class="card-title"><i class="fas fa-chart-line me-2"></i>Progress Overview</h5>
                            <hr>
                            <!-- AI Analysis Section (if available) -->
                            <div class="mb-4"
                                 th:if="${user.aiSkillsSummary != null || user.aiSuggestedImprovements != null}">
                                <h6><i class="fas fa-robot text-primary me-2"></i>AI CV Analysis</h6>
                                <div class="row">
                                    <div class="col-md-6" th:if="${user.aiSkillsSummary != null}">
                                        <div class="card border-primary mb-3">
                                            <div class="card-header bg-primary text-white">Skills Summary</div>
                                            <div class="card-body">
                                                <p class="card-text" th:text="${user.aiSkillsSummary}">Skills summary
                                                    will appear here.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" th:if="${user.aiSuggestedImprovements != null}">
                                        <div class="card border-info mb-3">
                                            <div class="card-header bg-info text-white">Suggested Improvements</div>
                                            <div class="card-body">
                                                <p class="card-text" th:text="${user.aiSuggestedImprovements}">
                                                    Improvement suggestions will appear here.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span><i class="fas fa-comment text-success me-2"></i>Answers</span>
                                        <span class="badge bg-success"
                                              th:text="${user.answerIds != null ? user.answerIds.size() : 0}">0</span>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-success" role="progressbar"
                                             th:style="'width: ' + ${user.answerIds != null && user.answerIds.size() > 0 ? (user.answerIds.size() <= 50 ? user.answerIds.size()*2 : 100) : 0} + '%'"
                                             th:aria-valuenow="${user.answerIds != null ? user.answerIds.size() : 0}"
                                             aria-valuemin="0"
                                             aria-valuemax="50">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span><i class="fas fa-sticky-note text-warning me-2"></i>Notes</span>
                                        <span class="badge bg-warning"
                                              th:text="${user.noteIds != null ? user.noteIds.size() : 0}">0</span>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-warning" role="progressbar"
                                             th:style="'width: ' + ${user.noteIds != null && user.noteIds.size() > 0 ? (user.noteIds.size() <= 50 ? user.noteIds.size()*2 : 100) : 0} + '%'"
                                             th:aria-valuenow="${user.noteIds != null ? user.noteIds.size() : 0}"
                                             aria-valuemin="0"
                                             aria-valuemax="50">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6 mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span><i class="fas fa-briefcase text-info me-2"></i>Vacancies</span>
                                        <span class="badge bg-info"
                                              th:text="${user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0}">0</span>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-info" role="progressbar"
                                             th:style="'width: ' + ${user.vacancyResponseIds != null && user.vacancyResponseIds.size() > 0 ? (user.vacancyResponseIds.size() <= 10 ? user.vacancyResponseIds.size()*10 : 100) : 0} + '%'"
                                             th:aria-valuenow="${user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0}"
                                             aria-valuemin="0"
                                             aria-valuemax="10">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span><i class="fas fa-tasks text-primary me-2"></i>Total Progress</span>
                                        <span class="badge bg-primary"
                                              th:text="${(user.answerIds != null ? user.answerIds.size() : 0) + (user.noteIds != null ? user.noteIds.size() : 0) + (user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0)}">0</span>
                                    </div>
                                    <div class="progress" style="height: 10px;">
                                        <div class="progress-bar bg-primary" role="progressbar"
                                             th:style="'width: ' + ${((user.answerIds != null ? user.answerIds.size() : 0) + (user.noteIds != null ? user.noteIds.size() : 0) + (user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0)) > 0 ? (((user.answerIds != null ? user.answerIds.size() : 0) + (user.noteIds != null ? user.noteIds.size() : 0) + (user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0)) <= 100 ? ((user.answerIds != null ? user.answerIds.size() : 0) + (user.noteIds != null ? user.noteIds.size() : 0) + (user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0)) : 100) : 0} + '%'"
                                             th:aria-valuenow="${(user.answerIds != null ? user.answerIds.size() : 0) + (user.noteIds != null ? user.noteIds.size() : 0) + (user.vacancyResponseIds != null ? user.vacancyResponseIds.size() : 0)}"
                                             aria-valuemin="0" aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light">
                    <h4 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a th:href="@{/notes/new}" class="text-decoration-none">
                                <div class="card h-100 border-warning hover-shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-sticky-note fa-3x text-warning mb-3"></i>
                                        <h5 class="card-title">Create Note</h5>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a th:href="@{/questions}" class="text-decoration-none">
                                <div class="card h-100 border-primary hover-shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-question-circle fa-3x text-primary mb-3"></i>
                                        <h5 class="card-title">Practice Questions</h5>
                                    </div>
                                </div>
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a th:href="@{/vacancies}" class="text-decoration-none">
                                <div class="card h-100 border-info hover-shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-briefcase fa-3x text-info mb-3"></i>
                                        <h5 class="card-title">Manage Vacancies</h5>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User's Answers -->
    <div class="card mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-comment text-success me-2"></i>Answers</h4>
            <a th:href="@{/questions}" class="btn btn-sm btn-success">
                <i class="fas fa-plus me-1"></i>Answer Questions
            </a>
        </div>
        <div class="card-body">
            <div th:if="${userAnswers != null && not #lists.isEmpty(userAnswers)}" class="list-group list-group-flush">
                <div th:each="answer : ${userAnswers}" class="list-group-item">
                    <div class="d-flex w-100 justify-content-between mb-2">
                        <h5 class="mb-1">
                            <a th:href="@{/questions/{id}(id=${answer.questionId})}"
                               th:text="${#strings.abbreviate(answer.questionText, 100)}">Question Text</a>
                        </h5>
                        <small th:text="${#temporals.format(answer.createdAt, 'dd MMM yyyy HH:mm')}">Date</small>
                    </div>
                    <p class="mb-1" th:text="${answer.text}">Answer text</p>
                    <div class="d-flex justify-content-end mt-2">
                        <a th:href="@{/answers/{id}/edit(id=${answer.id})}"
                           class="btn btn-sm btn-outline-secondary me-1">
                            <i class="fas fa-edit me-1"></i>Edit
                        </a>
                        <form th:action="@{/answers/{id}/delete(id=${answer.id})}" method="post"
                              style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Are you sure you want to delete this answer?')">
                                <i class="fas fa-trash-alt me-1"></i>Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div th:if="${userAnswers == null || #lists.isEmpty(userAnswers)}" class="text-center py-5">
                <i class="fas fa-comment fa-3x text-muted mb-3"></i>
                <p class="lead text-muted">No answers yet.</p>
                <a th:href="@{/questions}" class="btn btn-success">
                    <i class="fas fa-plus me-1"></i>Answer Questions
                </a>
            </div>
        </div>
    </div>

    <!-- User's Notes -->
    <div class="card mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-sticky-note text-warning me-2"></i>Notes</h4>
            <a th:href="@{/notes/new}" class="btn btn-sm btn-warning text-white">
                <i class="fas fa-plus me-1"></i>Add Note
            </a>
        </div>
        <div class="card-body">
            <div th:if="${userNotes != null && not #lists.isEmpty(userNotes)}" class="list-group list-group-flush">
                <div th:each="note : ${userNotes}" class="list-group-item">
                    <div class="d-flex w-100 justify-content-between mb-2">
                        <h5 class="mb-1">
                            <a th:href="@{/questions/{id}(id=${note.questionId})}"
                               th:text="${#strings.abbreviate(note.questionText, 100)}">Question Text</a>
                        </h5>
                        <small th:text="${#temporals.format(note.updatedAt, 'dd MMM yyyy HH:mm')}">Date</small>
                    </div>
                    <p class="mb-1" th:text="${note.noteText}">Note text</p>
                    <div class="d-flex justify-content-end mt-2">
                        <a th:href="@{/notes/{id}/edit(id=${note.id})}"
                           class="btn btn-sm btn-outline-secondary me-1">
                            <i class="fas fa-edit me-1"></i>Edit
                        </a>
                        <form th:action="@{/notes/{id}/delete(id=${note.id})}" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Are you sure you want to delete this note?')">
                                <i class="fas fa-trash-alt me-1"></i>Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div th:if="${userNotes == null || #lists.isEmpty(userNotes)}" class="text-center py-5">
                <i class="fas fa-sticky-note fa-3x text-muted mb-3"></i>
                <p class="lead text-muted">No notes yet.</p>
                <a th:href="@{/notes/new}" class="btn btn-warning text-white">
                    <i class="fas fa-plus me-1"></i>Add Note
                </a>
            </div>
        </div>
    </div>

    <!-- Back to List Button -->
    <div class="mt-4">
        <a th:href="@{/users}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Back to Users
        </a>
    </div>
</section>
</body>
</html>
