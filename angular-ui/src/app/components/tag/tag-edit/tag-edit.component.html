<div class="container-fluid px-4">
    <!-- Page Header -->
    <div class="page-header d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="bi bi-pencil-fill me-2 text-primary"></i>
                Edit Tag
            </h2>
            <p class="text-muted mb-0">Update tag information and settings</p>
        </div>
        <button class="btn btn-outline-secondary" (click)="cancel()">
            <i class="bi bi-arrow-left me-2"></i> Back to Tag
        </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="card">
        <div class="card-body text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Loading tag data...</p>
        </div>
    </div>

    <!-- Success Alert -->
    <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show shadow-sm" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <strong>Success!</strong> {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
    </div>

    <!-- Error Alert -->
    <div *ngIf="error" class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Error!</strong> {{ error }}
        <button type="button" class="btn-close" (click)="error = ''" aria-label="Close"></button>
    </div>

    <!-- Edit Form -->
    <div *ngIf="!isLoading" class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="bi bi-tag-fill me-2"></i>
                        Tag Information
                    </h5>
                </div>
                <div class="card-body">
                    <form [formGroup]="tagForm" (ngSubmit)="onSubmit()" novalidate>
                        <!-- Tag Name Field -->
                        <div class="mb-4">
                            <label for="name" class="form-label required">
                                <i class="bi bi-tag me-1"></i>
                                Tag Name
                            </label>
                            <input
                                    type="text"
                                    id="name"
                                    class="form-control"
                                    [class.is-invalid]="hasFieldError('name')"
                                    formControlName="name"
                                    placeholder="Enter tag name (e.g., JavaScript, React, Backend)"
                                    maxlength="50"
                            >
                            <div class="invalid-feedback" *ngIf="hasFieldError('name')">
                                {{ getFieldError('name') }}
                            </div>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                Use descriptive names that clearly identify the topic or technology.
                            </div>
                        </div>

                        <!-- Parent Tag Field -->
                        <div class="mb-4">
                            <label for="parentId" class="form-label">
                                <i class="bi bi-diagram-3 me-1"></i>
                                Parent Tag
                                <span class="text-muted">(Optional)</span>
                            </label>
                            <select
                                    id="parentId"
                                    class="form-select"
                                    [class.is-invalid]="hasFieldError('parentId')"
                                    formControlName="parentId"
                                    [disabled]="loadingParents"
                            >
                                <option value="">-- No Parent (Root Level) --</option>
                                <option *ngFor="let tag of availableParentTags" [value]="tag.id">
                                    {{ tag.name }}
                                    <span *ngIf="tag.path">({{ tag.path }})</span>
                                </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="hasFieldError('parentId')">
                                {{ getFieldError('parentId') }}
                            </div>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                <span *ngIf="loadingParents">Loading available parent tags...</span>
                                <span *ngIf="!loadingParents">Choose a parent tag to create a hierarchical structure, or leave empty for a root-level tag.</span>
                            </div>
                        </div>

                        <!-- Description Field -->
                        <div class="mb-4">
                            <label for="description" class="form-label">
                                <i class="bi bi-text-paragraph me-1"></i>
                                Description
                                <span class="text-muted">(Optional)</span>
                            </label>
                            <textarea
                                    id="description"
                                    class="form-control"
                                    [class.is-invalid]="hasFieldError('description')"
                                    formControlName="description"
                                    rows="4"
                                    placeholder="Provide a brief description of what this tag represents..."
                                    maxlength="500"
                            ></textarea>
                            <div class="invalid-feedback" *ngIf="hasFieldError('description')">
                                {{ getFieldError('description') }}
                            </div>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                Optional description to help others understand when to use this tag.
                            </div>
                        </div>


                        <!-- Change Indicator -->
                        <div *ngIf="hasChanges" class="alert alert-info d-flex align-items-center mb-4">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <span>You have unsaved changes.</span>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex gap-2">
                                <button
                                        type="submit"
                                        class="btn btn-primary"
                                        [disabled]="isSubmitting || tagForm.invalid || !hasChanges"
                                >
                                    <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"
                                          role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </span>
                                    <i *ngIf="!isSubmitting" class="bi bi-check-lg me-2"></i>
                                    {{ isSubmitting ? 'Updating...' : 'Update Tag' }}
                                </button>

                                <button
                                        type="button"
                                        class="btn btn-outline-secondary"
                                        (click)="resetForm()"
                                        [disabled]="isSubmitting || !hasChanges"
                                >
                                    <i class="bi bi-arrow-clockwise me-2"></i>
                                    Reset
                                </button>
                            </div>

                            <button
                                    type="button"
                                    class="btn btn-outline-danger"
                                    (click)="cancel()"
                                    [disabled]="isSubmitting"
                            >
                                <i class="bi bi-x-lg me-2"></i>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Original Data Card -->
            <div class="card shadow-sm mt-4" *ngIf="originalTag">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="bi bi-clock-history me-2"></i>
                        Original Information
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted">Original Name</label>
                                <div class="fw-medium">{{ originalTag.name || 'N/A' }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted">Last Updated</label>
                                <div>{{ originalTag.updatedAt | localDateTime:'MMM d, y h:mm a' }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-0" *ngIf="originalTag.description">
                        <label class="form-label text-muted">Original Description</label>
                        <div>{{ originalTag.description }}</div>
                    </div>
                </div>
            </div>

            <!-- Help Card -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="bi bi-lightbulb me-2"></i>
                        Editing Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-info">
                                <i class="bi bi-info-circle me-1"></i>
                                Important Notes
                            </h6>
                            <ul class="list-unstyled small">
                                <li><i class="bi bi-dot"></i> Changes affect all associated questions</li>
                                <li><i class="bi bi-dot"></i> Tag name changes may impact search results</li>
                                <li><i class="bi bi-dot"></i> Consider notifying team members of changes</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-warning">
                                <i class="bi bi-exclamation-triangle me-1"></i>
                                Best Practices
                            </h6>
                            <ul class="list-unstyled small">
                                <li><i class="bi bi-dot"></i> Keep names concise and clear</li>
                                <li><i class="bi bi-dot"></i> Use consistent naming conventions</li>
                                <li><i class="bi bi-dot"></i> Avoid special characters</li>
                                <li><i class="bi bi-dot"></i> Update description to reflect changes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>